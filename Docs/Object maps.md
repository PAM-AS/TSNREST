# Object maps purpose
Object maps in TSNREST are used to map the JSON you get from the server to your core data objects.

The object maps in TSNREST are optimized to work with auto-generated classes from Core Data.

## Generate an object map
For the classes you want to map, you need to generate an object map. Most objects can be generated automatically, like so:
```objective-c
TSNRESTObjectMap *productMap = [TSNRESTObjectMap autogeneratedMapForClass:[Product class]];
[[TSNRESTManager sharedManager] addObjectMap:productMap];
```
Note: You need to add the object map to the TSNRESTManager. This is for flexibility if you want to have some object temporarily mapped, or changed during the application lifetime.

There are a few exceptions that you need to add manually, as the automapper can't figure them out:

### Booleans
Booleans must be explicitly stated if they are to be converted to `true` or `false` when serializing. This is because Core Data saves them as NSNumber, and as such would be serialized to `1` or `0` normally.
```objective-c
[productMap addBooleans:@[@"visible",@"female", @"male"]];
```

### Many-relations
Many relations in Core Data are saved as NSSets. Therefore, TSNREST can't now what class to map the relation to, so you need to help it.
```objective-c
[productMap addClass:[Image class] forKey:@"images"];
```
### Override key names
Sometimes you may want to call something by a different name locally than on the server. In such cases you can override the key mapping manually:
```objective-c
[variantMap mapObjectKey:@"count" toWebKey:@"inventory"];
```

## URLs and paths
TSNREST uses a plural of the model name by default. For example, Product objects are expected to live on `<base-url>/products`. If you need to override this, set a server path explicitly:
```objective-c
[categoryMap setServerPath:@"categories"];
```

## Read-only keys
If you have any keys you don't want to be written back to the server, like auto-genrated time stamps etc, you can exclude them on saves by marking them as read-only:
```objective-c
[shopMap setReadOnlyKeys:@[@"createdAt", @"updatedAt"]];
```
Note: always use local keys when adding booleans, read only keys, etc.

## Push notification keys
TSNREST object maps have a push key property which you can use to update your models based on incoming push notifications. Note: Currently you need to handle the push notifications in your application code.

To set a push key:
```objective-c
[productMap setPushKey:@"p"];
```

## Manual mapping
If none of the options above does it for you, or you need to do some processing for each object loaded into the store or saved back to the server, you can add manual mapping blocks to do so. The blocks provide you with the data you need as block parameters.

Map web object to local object:
```objective-c
[productMap setMappingBlock:^(id object, NSManagedObjectContext *context, NSDictionary *dict) {
  Product *product = (Product *)object;
  product.priceReduction = product.price.intValue - [[dict objectForKey:@"salePrice"] intValue];
}];
```

Map local object to saving dictionary:
```objective-c
[productMap setReverseMappingBlock:^(id object, NSMutableDictionary *dict) {
  [dict setObject:[NSDate date] forKey:@"uploaded_at"];
}];
```
